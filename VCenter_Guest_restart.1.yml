# 
# https://docs.ansible.com/ansible/latest/modules/vmware_guest_module.html#vmware-guest-module
# Requirement 
# PyVmomi

#- name: Reboot VM {{ name }} in VCenter 
#  hosts: localhost
#  connection: local
#  gather_facts: True
#  tasks:
- name: 'Reboot VM:   {{ guest }}'
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    cluster:  "{{ vcenter_cluster }}"
    datacenter:  "{{ vcenter_datacenter }}"
    name: "{{ guest }}"
    #name: vpn
    validate_certs: no
    state: restarted
  delegate_to: localhost
  register: out
  tags: restart 

- name: Out
  debug:
    msg: "Restarting vm:    {{ guest }}"
  tags: restart

- name: Waiting for VM {{ guest }} to come back online...
  wait_for:
    host: "{{ guest }}"
    port: 22
    state: present
    sleep: 5
    delay: 15
    timeout: 900
  tags: restart 